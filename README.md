# 智能营销小工具 v1.0

> 一个功能强大的消息推送与图片管理平台，支持多种消息类型、图片转URL链接、批量操作等功能。

## 🌟 项目概述

智能营销小工具是一个现代化的企业级消息推送和图片管理平台，专为营销团队和内容创作者设计。系统提供便捷的消息推送服务、图片转URL工具、用户权限管理等功能，帮助用户高效管理营销内容和消息分发。

## 📸 界面预览

> 说明：以下截图文件位于 `public/images/`，如需更新请将同名图片替换为最新截图。

| 首页 | 任务管理 | 图片URL工具 | 数据看板 |
| --- | --- | --- | --- |
| ![首页预览](public/images/preview-home.png) | ![任务管理预览](public/images/preview-tasks.png) | ![图片URL工具预览](public/images/preview-image-tools.png) | ![数据看板预览](public/images/preview-dashboard.png) |

占位图命名（请按需替换为真实截图）：
- `public/images/preview-home.png` - 首页概览和快捷操作
- `public/images/preview-tasks.png` - 任务管理和消息创建
- `public/images/preview-image-tools.png` - 图片上传和URL生成
- `public/images/preview-dashboard.png` - 数据统计和图表展示

## ✨ 核心功能

### 📱 消息推送系统
- **多种消息类型**：支持文本消息、富文本消息、图文消息、卡片消息
- **定时推送**：支持设置具体时间，系统自动发送
- **批量推送**：支持同时推送到多个目标地址
- **分组管理**：支持按分组选择推送目标
- **实时反馈**：推送状态实时反馈和成功率统计

### 🖼️ 图片转URL工具
- **拖拽上传**：支持拖拽上传图片文件
- **多格式支持**：JPG、PNG、GIF、BMP、WEBP等格式
- **永久链接**：自动生成永久有效的URL链接
- **多格式输出**：支持直链、HTML、Markdown格式
- **批量管理**：支持图片预览、重命名、批量操作
- **历史记录**：完整的图片上传历史和管理功能

### ⚡ 首页快捷操作
- **4个核心功能入口**：首页提供直观的快捷操作卡片
  - **地址管理**：添加/维护 Webhook 地址（路径：`/addresses`）
  - **任务管理**：创建/管理推送任务（路径：`/tasks`）
  - **消息历史**：查看已发送消息记录（路径：`/history`）
  - **图片URL**：图片转永久链接工具（路径：`/image-tools`）
- **实时数据统计**：首页展示任务、地址、消息的实时统计数据
- **最近活动记录**：显示最近5条消息推送记录，便于快速了解系统状态

### 👥 用户权限管理
- **多角色支持**：超级管理员、管理员、普通用户
- **权限控制**：基于角色的细粒度权限管理
- **数据隔离**：用户数据完全隔离，确保安全性
- **身份切换**：管理员可切换身份查看不同用户数据

### 🎨 现代化UI设计
- **响应式设计**：完美适配桌面和移动设备
- **深色模式**：支持明暗主题切换
- **动画效果**：流畅的交互动画和过渡效果
- **组件化设计**：基于Ant Design的现代化组件库

## 🚀 技术栈

### 前端技术
- **React 18** - 现代化的用户界面库
- **Vite** - 快速的构建工具和开发服务器
- **Ant Design** - 企业级UI组件库
- **React Router** - 单页面应用路由
- **Axios** - HTTP客户端
- **React Markdown** - Markdown渲染组件

### 后端技术
- **Node.js** - JavaScript运行时环境
- **Express** - Web应用框架
- **Supabase** - 后端即服务(BaaS)平台
- **PostgreSQL** - 关系型数据库

### 云服务
- **Supabase Auth** - 用户认证和授权
- **Supabase Storage** - 文件存储服务
- **Supabase Database** - 数据库服务

## 📦 安装和运行

### 环境要求
- Node.js 16.0 或更高版本
- npm 或 yarn 包管理器

### 安装依赖
```bash
npm install
```

### 环境配置
1. 复制环境配置文件：
```bash
cp .env.example .env.local
```

2. 配置Supabase连接信息：
```env
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
```

### 启动开发服务器
```bash
# 启动前端开发服务器
npm run dev:frontend

# 启动后端开发服务器
npm run dev:backend

# 同时启动前后端
npm run dev:all
```

> 若 `dev:all` 因本机 `concurrently` 等依赖问题无法执行，可分别启动前后端（见上）。Vite 默认运行在 3000+ 端口占用顺延（如 3002）。

### 构建生产版本
```bash
npm run build
```

## 🗄️ 数据库结构

### 核心表结构
- **users** - 用户表
- **user_roles** - 用户角色表
- **groups** - 分组表
- **webhooks** - Webhook地址表
- **tasks** - 任务表
- **image_uploads** - 图片上传记录表

### 权限控制
- 基于Row Level Security (RLS)的数据隔离
- 用户只能访问自己的数据
- 管理员可以访问所有数据

## 🔧 功能模块

### 1. 任务管理
- 创建和管理推送任务
- 支持多种消息类型
- 定时推送功能
- 批量操作支持

### 2. 地址管理
- Webhook地址管理
- 分组管理
- 批量导入导出
- 地址有效性验证

### 3. 历史消息
- 推送历史记录
- 状态筛选和搜索
- 消息重发功能
- 成功率统计

### 4. 图片转URL工具
- **拖拽上传**：支持拖拽或点击上传图片文件
- **多格式支持**：JPG、PNG、GIF、BMP、WEBP等格式
- **URL链接生成**：自动生成永久有效的访问链接
- **多格式输出**：支持直链、HTML、Markdown格式
- **批量管理**：支持图片预览、重命名、批量操作
- **历史记录**：完整的图片上传历史和管理功能

> **存储方案**：采用 Supabase Storage，链接默认公开、长期有效；同时后端开启 RLS 并通过 `auth.uid()` 与应用用户的 `users.auth_uid` 映射保证数据隔离（仅本人可管理记录，链接对外可读）。

### 5. 数据看板
- **实时统计**：任务、地址、消息的实时数据统计
- **图表展示**：直观的数据可视化图表
- **状态监控**：推送成功率和失败率统计
- **历史趋势**：数据变化趋势分析

### 6. 用户管理
- **用户注册和登录**：支持邮箱密码登录
- **角色权限管理**：多角色权限控制
- **数据统计和分析**：用户行为数据统计

## 🎯 使用指南

### 消息推送
1. 进入"任务管理"页面
2. 点击"新建任务"按钮
3. 选择消息类型（文本、富文本、图文、卡片）
4. 填写消息内容
5. 选择推送分组
6. 设置推送时间（立即或定时）
7. 点击"创建任务"或"立即发送"

### 图片转URL
1. 进入"图片URL工具"页面
2. 拖拽或点击上传图片文件
3. 等待图片处理完成
4. 选择链接格式（直链、HTML、Markdown）
5. 一键复制链接使用

### 首页快捷操作
1. **数据刷新**：首页顶部右侧"刷新数据"按钮可手动刷新统计
2. **快捷导航**：在"快捷操作"卡片中点击：
   - 地址管理 → `/addresses`
   - 任务管理 → `/tasks`
   - 消息历史 → `/history`
   - 图片URL → `/image-tools`
3. **实时监控**：首页展示实时数据统计和最近活动记录

### 分组管理
1. 进入"地址管理"页面
2. 创建新的分组
3. 添加Webhook地址到分组
4. 在推送时选择目标分组

## 🔒 安全特性

- **数据加密**：敏感数据加密存储
- **权限控制**：基于角色的访问控制
- **数据隔离**：用户数据完全隔离
- **输入验证**：严格的数据验证和过滤
- **HTTPS支持**：安全的网络传输

## 📊 性能优化

- **懒加载**：组件和路由懒加载
- **缓存机制**：智能数据缓存
- **图片优化**：自动图片压缩和格式转换
- **数据库优化**：索引优化和查询优化

## 🐛 故障排除

### 常见问题
1. **图片上传失败**：检查文件格式和大小限制
2. **推送失败**：检查Webhook地址有效性
3. **权限错误**：确认用户角色和权限设置
4. **最近活动记录为空**：检查数据库连接和RLS策略配置
5. **首页数据不更新**：点击"刷新数据"按钮手动刷新

### 调试模式
- 开启浏览器开发者工具
- 查看控制台日志信息
- 检查网络请求状态

## 🤝 贡献指南

1. Fork 项目
2. 创建功能分支
3. 提交更改
4. 推送到分支
5. 创建 Pull Request

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情

## 📞 支持与联系

- 项目地址：[GitHub Repository]
- 问题反馈：[Issues]
- 文档地址：[Documentation]

## 🎉 更新日志

### v1.0-0926-hotfix-login (2025-09-26)
- 🔒 修复登录/注册失败：统一前后端使用 `password_hash` 字段进行密码校验
- 🔑 兼容多种密码格式：明文、Base64、bcrypt（bcrypt 通过后端 `/api/verify-password` 校验）
- 📨 注册体验优化：邮箱改为可选，前端表单已同步调整
- 🛠️ 新增后端接口：`POST /api/register`（用于服务器侧创建用户与分配角色）
- 🧷 RLS 临时处理：提供 SQL 关闭 public.`users`/`user_roles` 的 RLS 以快速恢复功能；后续可在拿到 Service Role Key 后逐步恢复
- 🧰 维护建议：为当前稳定状态创建标签 `v1.0-0926-hotfix-login`，便于回滚

### v1.0 (2025-09-24)
- ✨ **新增图片转URL工具**：Supabase Storage存储，永久公开链接，支持批量操作
- 🎨 **首页重构**：移除"快速开始"，并入"快捷操作"（四列栅格），统一卡片风格
- 🧭 **导航优化**：快捷操作直达核心页面（地址管理/任务管理/消息历史/图片URL）
- 🧩 **布局修复**：侧边栏收缩时Header与Sider对齐，无空隙，带过渡动画
- 📝 **任务管理优化**：
  - 立即发送使用已保存内容（无需再编辑）
  - 富文本/分组选择保存与回填
  - 文本-图片消息内容结构与查询补齐
- 🛡️ **权限系统**：补充`users.auth_uid`映射、storage读写策略与image_uploads访问策略
- 📱 **UI优化**：移动端与暗色模式视觉对比优化
- 🐛 **Bug修复**：修复最近活动记录显示问题，优化数据库约束

### v1.0.0
- 新增AI智能助手功能
- 支持深色模式切换
- 优化用户权限管理
- 改进任务管理界面

### 历史版本（归档）
- 新增富文本消息支持
- 优化图片处理逻辑
- 改进错误处理机制
- 增强数据安全性

---

**智能营销小工具** - 让营销更简单，让内容更精彩！ 🚀