# æ™ºèƒ½è¥é”€å·¥å…· - é¡¹ç›®æ–‡ä»¶ç»“æ„

## ğŸ“ é¡¹ç›®æ ¹ç›®å½•

```
æ™ºèƒ½è¥é”€å·¥å…·1.0/
â”œâ”€â”€ ğŸ“„ é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ .env.local                    # ç¯å¢ƒå˜é‡é…ç½®ï¼ˆåŒ…å«Supabaseå¯†é’¥ï¼‰
â”‚   â”œâ”€â”€ .env.local.template           # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”‚   â”œâ”€â”€ .gitignore                    # Gitå¿½ç•¥æ–‡ä»¶é…ç½®
â”‚   â”œâ”€â”€ package.json                  # é¡¹ç›®ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ package-lock.json             # ä¾èµ–é”å®šæ–‡ä»¶
â”‚   â”œâ”€â”€ vite.config.js                # Viteæ„å»ºé…ç½®
â”‚   â””â”€â”€ config.js                     # åº”ç”¨é…ç½®æ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ“ æ–‡æ¡£æ–‡ä»¶
â”‚   â”œâ”€â”€ README.md                     # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”‚   â”œâ”€â”€ FIX_IMAGE_UPLOAD.md          # å›¾ç‰‡ä¸Šä¼ é—®é¢˜ä¿®å¤æŒ‡å—
â”‚   â””â”€â”€ PROJECT_STRUCTURE.md         # é¡¹ç›®æ–‡ä»¶ç»“æ„è¯´æ˜ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”‚
â”œâ”€â”€ ğŸ—„ï¸ æ•°æ®åº“è„šæœ¬ (database/)
â”‚   â”œâ”€â”€ init_database.sql            # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ add_image_uploads_table.sql  # å›¾ç‰‡ä¸Šä¼ è¡¨åˆ›å»ºè„šæœ¬
â”‚   â”œâ”€â”€ ai_knowledge_tables.sql      # AIçŸ¥è¯†åº“è¡¨åˆ›å»ºè„šæœ¬
â”‚   â”œâ”€â”€ database_structure.md        # æ•°æ®åº“ç»“æ„è¯´æ˜
â”‚   â”œâ”€â”€ fix_all_rls_issues.sql       # ä¸€é”®ä¿®å¤æ‰€æœ‰RLSé—®é¢˜ï¼ˆæ¨èï¼‰
â”‚   â”œâ”€â”€ fix_storage_rls.sql          # ä¿®å¤Storageæƒé™ç­–ç•¥
â”‚   â”œâ”€â”€ disable_image_uploads_rls.sql # ç¦ç”¨image_uploadsè¡¨RLS
â”‚   â”œâ”€â”€ create_image_upload_function.sql # å›¾ç‰‡ä¸Šä¼ å‡½æ•°
â”‚   â”œâ”€â”€ fix_image_uploads_rls.sql    # ä¿®å¤å›¾ç‰‡ä¸Šä¼ RLSç­–ç•¥
â”‚   â”œâ”€â”€ fix_ai_conversations_simple.sql # ä¿®å¤AIå¯¹è¯è¡¨RLS
â”‚   â”œâ”€â”€ fix_rls_final.sql            # æœ€ç»ˆRLSä¿®å¤è„šæœ¬
â”‚   â””â”€â”€ maintenance_scripts.sql      # æ•°æ®åº“ç»´æŠ¤è„šæœ¬
â”‚
â”œâ”€â”€ ğŸ“š æ–‡æ¡£ç›®å½• (docs/)
â”‚   â””â”€â”€ AI_ç”¨æˆ·å¸®åŠ©ä¸­å¿ƒ.md            # AIç”¨æˆ·å¸®åŠ©æ–‡æ¡£
â”‚
â”œâ”€â”€ ğŸŒ å‰ç«¯æºä»£ç  (src/)
â”‚   â”œâ”€â”€ pages/                       # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Dashboard.jsx            # ä»ªè¡¨æ¿
â”‚   â”‚   â”œâ”€â”€ MessageEditor.jsx        # æ¶ˆæ¯ç¼–è¾‘å™¨
â”‚   â”‚   â”œâ”€â”€ MessageTemplate.jsx      # æ¶ˆæ¯æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ ImageTools.jsx           # å›¾ç‰‡è½¬URL
â”‚   â”‚   â”œâ”€â”€ AIAssistant.jsx          # AIåŠ©æ‰‹
â”‚   â”‚   â”œâ”€â”€ HelpCenter.jsx           # å¸®åŠ©ä¸­å¿ƒ
â”‚   â”‚   â””â”€â”€ Settings.jsx             # è®¾ç½®é¡µé¢
â”‚   â”‚
â”‚   â”œâ”€â”€ components/                  # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Auth/                    # è®¤è¯ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Login.jsx           # ç™»å½•ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ Register.jsx        # æ³¨å†Œç»„ä»¶
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ImageUpload/            # å›¾ç‰‡ä¸Šä¼ ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ImageUpload.jsx     # å›¾ç‰‡ä¸Šä¼ ä¸»ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ImagePreview.jsx    # å›¾ç‰‡é¢„è§ˆç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ImageHistory.jsx    # å›¾ç‰‡å†å²è®°å½•
â”‚   â”‚   â”‚   â””â”€â”€ LinkManager.jsx     # é“¾æ¥ç®¡ç†ç»„ä»¶
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Layout/                 # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ MainLayout.jsx      # ä¸»å¸ƒå±€
â”‚   â”‚   â”‚   â””â”€â”€ Sidebar.jsx         # ä¾§è¾¹æ 
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ AIChatBot.jsx           # AIèŠå¤©æœºå™¨äºº
â”‚   â”‚   â””â”€â”€ ThemeToggle.jsx         # ä¸»é¢˜åˆ‡æ¢ç»„ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ contexts/                   # Reactä¸Šä¸‹æ–‡
â”‚   â”‚   â”œâ”€â”€ AuthContext.jsx         # è®¤è¯ä¸Šä¸‹æ–‡
â”‚   â”‚   â””â”€â”€ ThemeContext.jsx        # ä¸»é¢˜ä¸Šä¸‹æ–‡
â”‚   â”‚
â”‚   â””â”€â”€ utils/                      # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ helpers.js              # è¾…åŠ©å‡½æ•°
â”‚
â”œâ”€â”€ ğŸ¨ æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ App.css                     # åº”ç”¨ä¸»æ ·å¼
â”‚   â”œâ”€â”€ index.css                   # å…¨å±€æ ·å¼
â”‚   â””â”€â”€ main.jsx                    # åº”ç”¨å…¥å£æ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ”§ åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ server.js                   # Node.jsåç«¯æœåŠ¡ï¼ˆExpressï¼‰
â”‚   â””â”€â”€ supabaseClient.js           # Supabaseå®¢æˆ·ç«¯é…ç½®
â”‚
â”œâ”€â”€ ğŸŒ å…¬å…±èµ„æº (public/)
â”‚   â”œâ”€â”€ images/                     # å›¾ç‰‡èµ„æº
â”‚   â”‚   â””â”€â”€ ai-robot-icon.png      # AIæœºå™¨äººå›¾æ ‡
â”‚   â””â”€â”€ favicon.ico                 # ç½‘ç«™å›¾æ ‡
â”‚
â”œâ”€â”€ ğŸ“¦ ä¸Šä¼ æ–‡ä»¶å­˜å‚¨ (uploads/)
â”‚   â””â”€â”€ [user_id]/                  # æŒ‰ç”¨æˆ·IDç»„ç»‡çš„ä¸Šä¼ æ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ—ï¸ æ„å»ºè¾“å‡º (dist/)
â”‚   â””â”€â”€ [ç”Ÿäº§ç¯å¢ƒæ„å»ºæ–‡ä»¶]           # npm run build è¾“å‡º
â”‚
â””â”€â”€ ğŸ“¦ ä¾èµ–æ¨¡å— (node_modules/)
    â””â”€â”€ [Node.jsä¾èµ–åŒ…]              # npm install å®‰è£…çš„åŒ…
```

## ğŸ”‘ æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### åç«¯æœåŠ¡ (server.js)
- **åŠŸèƒ½**ï¼š
  - ä¼ä¸šå¾®ä¿¡Webhookä¸­è½¬æœåŠ¡
  - å›¾ç‰‡ä¸Šä¼ APIï¼ˆæ”¯æŒä¸­æ–‡æ–‡ä»¶åï¼‰
  - æ¶ˆæ¯æ¨é€API
  - å®šæ—¶ä»»åŠ¡ç®¡ç†
  - AIåŠ©æ‰‹APIä»£ç†

### å‰ç«¯å…¥å£ (main.jsx)
- **åŠŸèƒ½**ï¼š
  - Reactåº”ç”¨åˆå§‹åŒ–
  - è·¯ç”±é…ç½®
  - å…¨å±€çŠ¶æ€ç®¡ç†

### åº”ç”¨ä¸»ç»„ä»¶ (App.jsx)
- **åŠŸèƒ½**ï¼š
  - åº”ç”¨è·¯ç”±ç®¡ç†
  - é¡µé¢å¸ƒå±€
  - è®¤è¯çŠ¶æ€ç®¡ç†

### Supabaseå®¢æˆ·ç«¯ (supabaseClient.js)
- **åŠŸèƒ½**ï¼š
  - Supabaseæ•°æ®åº“è¿æ¥
  - è®¤è¯æœåŠ¡é…ç½®
  - Storageé…ç½®

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

### ä¸»è¦æ•°æ®è¡¨
1. **users** - ç”¨æˆ·è¡¨
2. **user_roles** - ç”¨æˆ·è§’è‰²è¡¨
3. **scheduled_messages** - å®šæ—¶æ¶ˆæ¯è¡¨
4. **message_templates** - æ¶ˆæ¯æ¨¡æ¿è¡¨
5. **image_uploads** - å›¾ç‰‡ä¸Šä¼ è®°å½•è¡¨
6. **ai_knowledge_base** - AIçŸ¥è¯†åº“è¡¨
7. **ai_conversations** - AIå¯¹è¯è®°å½•è¡¨
8. **ai_conversation_messages** - AIå¯¹è¯æ¶ˆæ¯è¡¨

è¯¦ç»†è¡¨ç»“æ„è¯·å‚è€ƒï¼š`database/database_structure.md`

## ğŸš€ å¯åŠ¨å‘½ä»¤

### å¼€å‘ç¯å¢ƒ
```bash
# å¯åŠ¨åç«¯æœåŠ¡
npm run dev:backend

# å¯åŠ¨å‰ç«¯æœåŠ¡
npm run dev:frontend

# åŒæ—¶å¯åŠ¨å‰åç«¯
npm run dev
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡
npm start
```

## ğŸ“ é…ç½®æ–‡ä»¶è¯´æ˜

### .env.local
åŒ…å«æ•æ„Ÿé…ç½®ä¿¡æ¯ï¼š
- `VITE_SUPABASE_URL` - Supabaseé¡¹ç›®URL
- `VITE_SUPABASE_ANON_KEY` - SupabaseåŒ¿åå¯†é’¥
- `VITE_SUPABASE_SERVICE_KEY` - SupabaseæœåŠ¡å¯†é’¥
- `VITE_WEBHOOK_URL` - ä¼ä¸šå¾®ä¿¡Webhookåœ°å€
- `VITE_ZHIPU_API_KEY` - æ™ºè°±AI APIå¯†é’¥

### package.json
å…³é”®ä¾èµ–ï¼š
- **å‰ç«¯æ¡†æ¶**ï¼šReact 18.3.1
- **æ„å»ºå·¥å…·**ï¼šVite 5.4.20
- **UIç»„ä»¶åº“**ï¼šAnt Design 5.21.2
- **åç«¯æ¡†æ¶**ï¼šExpress 4.21.0
- **æ•°æ®åº“**ï¼š@supabase/supabase-js 2.45.4
- **å›¾ç‰‡å¤„ç†**ï¼šsharp 0.33.5
- **æ–‡ä»¶ä¸Šä¼ **ï¼šmulter 1.4.5-lts.1
- **å®šæ—¶ä»»åŠ¡**ï¼šnode-cron 3.0.3

## ğŸ” æƒé™ç®¡ç†

### RLS (Row Level Security) ç­–ç•¥
- **image_uploadsè¡¨**ï¼šRLSå·²ç¦ç”¨ï¼Œå…è®¸æ‰€æœ‰ç”¨æˆ·ä¸Šä¼ 
- **Storageç­–ç•¥**ï¼šå·²é…ç½®å…è®¸æ‰€æœ‰ç”¨æˆ·è®¿é—®smart-message-images bucket

è¯¦ç»†ä¿®å¤æŒ‡å—è¯·å‚è€ƒï¼š`FIX_IMAGE_UPLOAD.md`

## ğŸ“Œ é‡è¦ç‰¹æ€§

### 1. å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
- âœ… æ”¯æŒä¸­æ–‡æ–‡ä»¶å
- âœ… è‡ªåŠ¨å‹ç¼©è¶…è¿‡1MBçš„å›¾ç‰‡
- âœ… ç”Ÿæˆå¤šç§æ ¼å¼çš„é“¾æ¥ï¼ˆç›´é“¾ã€HTMLã€Markdownï¼‰
- âœ… å†å²è®°å½•ç®¡ç†
- âœ… æ‰¹é‡æ“ä½œæ”¯æŒ

### 2. AIåŠ©æ‰‹åŠŸèƒ½
- âœ… æ™ºè°±AIé›†æˆ
- âœ… å¯¹è¯å†å²ç®¡ç†
- âœ… çŸ¥è¯†åº“æ”¯æŒ
- âœ… ä¸Šä¸‹æ–‡è®°å¿†

### 3. æ¶ˆæ¯æ¨é€åŠŸèƒ½
- âœ… ä¼ä¸šå¾®ä¿¡Webhooké›†æˆ
- âœ… å®šæ—¶æ¨é€
- âœ… æ¶ˆæ¯æ¨¡æ¿ç®¡ç†
- âœ… å›¾æ–‡æ¶ˆæ¯æ”¯æŒ

### 4. ä¸»é¢˜ç³»ç»Ÿ
- âœ… æ˜æš—ä¸»é¢˜åˆ‡æ¢
- âœ… ä¸»é¢˜æŒä¹…åŒ–
- âœ… å…¨å±€ä¸»é¢˜çŠ¶æ€ç®¡ç†

## ğŸ› ï¸ å¼€å‘å·¥å…·

### æ¨èçš„IDEæ’ä»¶
- ESLint - ä»£ç è§„èŒƒæ£€æŸ¥
- Prettier - ä»£ç æ ¼å¼åŒ–
- Vite - å¿«é€Ÿå¼€å‘æœåŠ¡å™¨

## ğŸ“¦ éƒ¨ç½²è¯´æ˜

### ç¯å¢ƒè¦æ±‚
- Node.js >= 18.0.0
- npm >= 9.0.0

### éƒ¨ç½²æ­¥éª¤
1. å…‹éš†é¡¹ç›®
2. å¤åˆ¶ `.env.local.template` ä¸º `.env.local` å¹¶å¡«å…¥é…ç½®
3. è¿è¡Œ `npm install` å®‰è£…ä¾èµ–
4. åœ¨Supabaseä¸­æ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
5. è¿è¡Œ `npm run build` æ„å»ºç”Ÿäº§ç‰ˆæœ¬
6. è¿è¡Œ `npm start` å¯åŠ¨æœåŠ¡

## ğŸ”„ ç‰ˆæœ¬ä¿¡æ¯

- **å½“å‰ç‰ˆæœ¬**ï¼š1.0.0
- **æœ€åæ›´æ–°**ï¼š2025å¹´10æœˆ11æ—¥
- **Node.jsç‰ˆæœ¬**ï¼š18.x
- **Reactç‰ˆæœ¬**ï¼š18.3.1

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- `README.md` - é¡¹ç›®åŸºæœ¬è¯´æ˜
- `docs/FIX_IMAGE_UPLOAD.md` - å›¾ç‰‡ä¸Šä¼ é—®é¢˜ä¿®å¤
- `docs/AI_ç”¨æˆ·å¸®åŠ©ä¸­å¿ƒ.md` - AIåŠŸèƒ½ä½¿ç”¨æŒ‡å—
- `database/database_structure.md` - æ•°æ®åº“ç»“æ„è¯´æ˜
